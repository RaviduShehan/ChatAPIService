pipeline {
    agent any
    environment {
        dockerImageName = "${params.DOCKER_IMAGE_NAME}"
        kubeconfigId = "${params.KUBECONFIG_ID}"

        gkeClusterName = "openai-api-cluster"
        gkeZone = "us-central1-c"
        gkeCredentialsId = "apiservicesauth"
        NAMESPACE_ID= dev
        DEPLOYMENT_ID= chatapidev
    }
    stages{
        stage('Deploy to Dev Environment') {
                steps {
                    sh "sed -i 's/NAMESPACE/${NAMESPACE_ID}/g' chat.yml"
                    sh "sed -i 's/DEPLOYMENT_NAME/${DEPLOYMENT_ID}/g' chat.yml"
                    step([
                        $class: 'KubernetesEngineBuilder',
                        projectId: 'apiservices-384122',
                        credentialsId: gkeCredentialsId,
                        clusterName: gkeClusterName,
                        location: gkeZone,
                        manifestPattern: 'chat.yml'])

                   }
        }
        stage('Get docker Image'){
           steps {
                script {
                    echo "Docker image name: ${dockerImageName}"
                }
            }

        }

    }
}


